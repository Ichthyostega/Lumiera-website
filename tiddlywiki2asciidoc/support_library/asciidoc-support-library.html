<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.5" />
<title></title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
</div>
<div class="paragraph"><p><a id="support-library-Cuckoo"></a></p></div>
<h2 id="_cuckoo">Cuckoo</h2>
<div class="sectionbody">
<div class="paragraph"><p>This hashing gives guaranteed O(1) lookup complexity and amortized O(1) insert and remove complexity. Hash tables by default grow and shrink automatically. It is posible to preallocate entries and turn automatic shrinking off taking out the memory management factors for insert and remove operations. This implementation uses 3 Tables which exponential growing sizes.</p></div>
<div class="paragraph"><p>Hash table utilization is commonly between 40-80% which gives better memory usage and far better locality than trees.</p></div>
<div class="paragraph"><p><a id="support-library-ErrorHandling-C"></a></p></div>
</div>
<h2 id="_errorhandling_c">ErrorHandling-C</h2>
<div class="sectionbody">
<h3 id="_proposal">Proposal:</h3><div style="clear:left"></div>
<div class="paragraph"><p>We need some centralized way to handle errors and doing hard aborts.</p></div>
<div class="paragraph"><p>I started using C-string addresses as errors for now. I think that is convenient and unique enough until we find something better. (Actually, this might be even kept in a library. Alternatively, maybe someone wants to investigate libcomerr)</p></div>
<div class="paragraph"><p>Notes about libcomerr (I took a short look now):</p></div>
<div class="ulist"><ul>
<li>
<p>
needs some central error description table which has to be compiled with compile_et
</p>
</li>
<li>
<p>
no homepage found, some projects use it, published in 1989, dunno about its state
</p>
</li>
</ul></div>
<div class="paragraph"><p>My following proposal defines a very simplistic way to define unique errors which can distributed throughout the application (each part can define its own errors and will never interfere with others)</p></div>
<h4 id="_detailed_semantics_proposal">detailed semantics (proposal):</h4>
<div class="paragraph"><p>a TLS pointer is allocated to keep a thread local error state. NULL means SUCCESS, no error pending.</p></div>
<div class="paragraph"><p>API:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_error_set</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span> err<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>if there is no error pending, then store err as new error state, if there was an error pending, then the state is not altered.</p></div>
<div class="paragraph"><p>return the former state (NULL if err got set, some other when an error is pending)</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_error</span></span> <span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>returns the error state <strong>and</strong> clears it. The user has to store it temporary when need to be used further. Rationale: less TLS access overhead, never forget to clear the state.</p></div>
<div class="paragraph"><p>(do we need a <tt>lumiera_error_peek()</tt>?)</p></div>
<div class="paragraph"><p>Declaration and definition:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">LUMIERA_ERROR_DECLARE</span></span><span style="color: #990000">(</span>err<span style="color: #990000">)</span> <span style="color: #990000">\</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> LUMIERA_ERROR_##err

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">LUMIERA_ERROR_DEFINE</span></span><span style="color: #990000">(</span>err<span style="color: #990000">,</span> msg<span style="color: #990000">)</span> <span style="color: #990000">\</span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> LUMIERA_ERROR_##err <span style="color: #990000">=</span> <span style="color: #FF0000">"LUMIERA_ERROR_"</span> #err <span style="color: #FF0000">":"</span> msg</tt></pre></div></div>
<div class="paragraph"><p>thus a <tt>LUMIERA_ERROR_DEFINE(NFOO, "Foo not found")</tt> will result in a string:
"LUMIERA_ERROR_NFOO:Foo not found", having the identifier itself prepended to the string will ensure uniqueness of the generated literal (and thus its pointer value), reducing error testing to address comparison <tt>lumiera_error()==LUMIERA_ERROR_NFOO</tt>. The message string is easily derived by <tt>strchr(LUMIERA_ERROR_NFOO, ":")+1</tt></p></div>
<h4 id="_allocation">Allocation</h4>
<div class="paragraph"><p>The next point is allocation failures. These are possible by C/C++ standard but don&#8217;t actually happen anymore in Linux (except in few rare cases). Instead of gracefully handling this errors I&#8217;ll add a <tt>LUMIERA_DIE(message)</tt> macro to this library later. This macro will just do (NoBug) logging and then doing a hard abort. It should be a macro because we want to preserve file/line location for logging.</p></div>
<div class="paragraph"><p><a id="support-library-ErrorHandling-Cpp"></a></p></div>
</div>
<h2 id="_errorhandling_cpp">ErrorHandling-Cpp</h2>
<div class="sectionbody">
<div class="paragraph"><p>Basically, the C++ error handling techniques are layered on top of the <a href="#ErrorHandling-C">C solution</a>.</p></div>
<h3 id="_proposal_2">Proposal:</h3><div style="clear:left"></div>
<div class="paragraph"><p>We use a common base class for all our application specific exceptions. These exceptions can be thought of as a classification of error situations, thus the hierarchical approach. The purpose of throwing such a <em>classified exception</em> is</p></div>
<div class="ulist"><ul>
<li>
<p>
to do a controlled partial failure
</p>
</li>
<li>
<p>
to trigger automatic cleanup without the need to implement the details
</p>
</li>
</ul></div>
<h4 id="_requirements_for_the_exception_interface">Requirements for the Exception Interface</h4>
<div class="ulist"><ul>
<li>
<p>
a means for capturing and transporting detail informations
</p>
</li>
<li>
<p>
the possibility to get at the <strong>root cause</strong> of an exception, even after having passed several subsystem barriers.
</p>
</li>
<li>
<p>
getting standardized error messages automatically
</p>
</li>
</ul></div>
<h4 id="_provided_features">provided features</h4>
<div class="paragraph"><p>The C++ errorhandling Classes and functions can be found in <tt>common/error.hpp</tt> (not to be confused with the elementary C errorhandling of the Lumiera support lib <tt>lib/error.h</tt>. See also the "exceptionerrortest.cpp"</p></div>
<div class="ulist"><ul>
<li>
<p>
the constructor of the Exception base class will set the C-style error flag as well. Obviously, when an exception gets caught and handled, this error-flag should be reset (and this is the responsibility of the handler).
</p>
</li>
<li>
<p>
we add a <tt>unknown()</tt> handler which will print additional diagnostics.
</p>
</li>
<li>
<p>
the Exception class has a diagnostic message intended for developers and a friendly message for the user. It is encouraged to write a detailed description of each error situation right into a string constant passed to the exception object ctor. This will serve the purpose of documenting the error situation in the source code and at the same time help diagnosis.
</p>
</li>
<li>
<p>
there is a variant of the constructor taking a reference to an std::exception. This is intended for <em>chained exceptions</em>. Whenever an handler catches an exception, but then decides to rethrow it with different classification, the original exception object should be passed on by using this constructor, so it&#8217;s <tt>what()</tt> message can be preserved and will be included in the final log entry. While this may look like overkill in a small example, it is a very helpful facility in a larger layered application, where it is often difficult to spot the original cause of an exception encountered.
</p>
</li>
<li>
<p>
for each mayor category of Exception subclasses, we define a C-style error constant. The client code is free to define further detailed error constants and Exception subclasses.
</p>
</li>
<li>
<p>
to help defining Exception subclasses, a macro <tt>LUMIERA_EXCEPTION_DECLARE</tt> is provided.
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="rows"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">basic Exception categories</caption>
<col width="184" />
<col width="615" />
<thead>
  <tr>
    <th align="left">
    category
    </th>
    <th align="left">
    description
    </th>
  </tr>
</thead>
<tbody valign="top">
  <tr>
    <td align="left">
    error::Logic
    </td>
    <td align="left">
    contradiction to internal logic assumptions detected
    </td>
  </tr>
  <tr>
    <td align="left">
    error::Fatal
    </td>
    <td align="left">
    special subclass of Logic: situation can&#8217;t be handled, internal logic floundered
    </td>
  </tr>
  <tr>
    <td align="left">
    error::Config
    </td>
    <td align="left">
    execution aborted due to misconfiguration
    </td>
  </tr>
  <tr>
    <td align="left">
    error::State
    </td>
    <td align="left">
    unforeseen internal state
    </td>
  </tr>
  <tr>
    <td align="left">
    error::Invalid
    </td>
    <td align="left">
    invalid input or parameters encountered
    </td>
  </tr>
  <tr>
    <td align="left">
    error::External
    </td>
    <td align="left">
    failure in external service the application relies on
    </td>
  </tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><a id="support-library-FrameAndTime"></a></p></div>
</div>
<h2 id="_frameandtime">FrameAndTime</h2>
<div class="sectionbody">
<h3 id="_framerates">Framerates</h3><div style="clear:left"></div>
<div class="paragraph"><p>Framerates are stored as rational numbers eg. 30000/1001 for NTSC, this representation allows highly precise integer calculations for frames and times.</p></div>
<h3 id="_frames">Frames</h3><div style="clear:left"></div>
<div class="paragraph"><p>All calculations in Lumiera are based on frames which is a signed integer type. Together with a Framerate and a starting point, every frame can be exactly located.</p></div>
<h3 id="_time">Time</h3><div style="clear:left"></div>
<div class="paragraph"><p>Time is used only internally in Lumiera, every external representation of time will be converted to frames. Time has a precision of 1 microsecond and is stored in POSIX struct timeval. Time is always handled as absolute time, thus frame addresses map to absolute times, there is at worst a 1us precision jitter but no drift.</p></div>
<h4 id="_smpte_and_other_timecodes">SMPTE and other Timecodes</h4>
<div class="paragraph"><p>will be added on demand, but be frame based, not time based</p></div>
<div class="paragraph"><p><a id="support-library-LockingPrimitives"></a></p></div>
</div>
<h2 id="_lockingprimitives">LockingPrimitives</h2>
<div class="sectionbody">
<h3 id="_provided_locking_primitives">Provided Locking Primitives</h3><div style="clear:left"></div>
<div class="paragraph"><p>The support library provides wrappers around some pthread locking primitives to make their usage more robust and easier.</p></div>
<div class="paragraph"><p>The basic concept is that each locking primitive is an object as well as each locker is implemented as object too, this adds a small convenience layer for robustness. We use NoBug to assert that locks are properly unlocked.</p></div>
<h4 id="_mutex">Mutex</h4>
<div class="paragraph"><p>We only support fast (non recursive, non errorcheck) mutexes for now. Debugging deadlock detection will be done in NoBug. If we need dynamic deadlock detection we will have to support errorcheck mutexes at demand. Same for recursive mutexes.</p></div>
<h4 id="_condition_variables">Condition Variables</h4>
<div class="paragraph"><p>Condition variables are simple synchronization devices, refer to the doxygen docs about using them. One needs to lock them when preparing to wait on them and finally unlock them. While signaling can optionally be done without a locker object (locking is implicit then).</p></div>
<h4 id="_read_write_locks">Read/Write Locks</h4>
<div class="paragraph"><p>Similar to mutexes we support multiple-reader/one-writer locks, they can be used whenever many concurrent read accesses and rare write accesses are expected to some datastructure (profile this later). When congestion rather unexpected then prefer a mutex.</p></div>
<h3 id="_no_semaphores_rationale">No Semaphores Rationale</h3><div style="clear:left"></div>
<div class="paragraph"><p>Semaphores have quite ugly semantics and are very hard to debug. For now (and likely forever) we will not to use them.</p></div>
<h3 id="_todo">ToDo</h3><div style="clear:left"></div>
<h4 id="_trylock_and_timedlock">trylock and timedlock</h4>
<div class="paragraph"><p>is not yet implemented but will be added in request.</p></div>
<h4 id="_barriers">Barriers</h4>
<div class="paragraph"><p>will be added on request too.</p></div>
<h4 id="_thread_cancellation">Thread Cancellation</h4>
<div class="paragraph"><p>Thread cancellation policies are not yet finally decided, for now we consider threads uncancelable!</p></div>
<div class="paragraph"><p><a id="support-library-MainMenu"></a></p></div>
</div>
<h2 id="_mainmenu">MainMenu</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="../index/asciidoc-index.html"><strong>Lumiera</strong></a></p></div>
<div class="paragraph"><p>SupportLibrary</p></div>
<div class="paragraph"><p><a href="#Threads and Locking">Threads and Locking</a></p></div>
<div class="paragraph"><p><a href="#Plugins">Plugins</a></p></div>
<div class="paragraph"><p><a href="#ErrorHandling">ErrorHandling</a></p></div>
<div class="paragraph"><p><a href="#OS Services">OS Services</a></p></div>
<div class="paragraph"><p><a id="support-library-PluginInterfaceDefinition"></a></p></div>
</div>
<h2 id="_plugininterfacedefinition">PluginInterfaceDefinition</h2>
<div class="sectionbody">
<div class="paragraph"><p>Interfaces are declared in header files. They use some tool macros to give a convenient definition language.</p></div>
<h3 id="_thoughts">Thoughts</h3><div style="clear:left"></div>
<div class="paragraph"><p>Interfaces are immutable with the exception that new functions may be added. Versioning should stay out of the view most of the time.</p></div>
<h3 id="_brainstorming">Brainstorming</h3><div style="clear:left"></div>
<div class="paragraph"><p>An interface needs a name and a version. They define a block where the actual function prototypes can be added. New prototypes have to be added at the end, existing prototypes must never be changed.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> version<span style="color: #990000">,</span>
        <span style="color: #990000">...</span>
<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Each function prototype must be given with its different parts: return type, name, arguments list, and version.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>        <span style="font-weight: bold"><span style="color: #000000">LUMIERA_IPROTO</span></span><span style="color: #990000">(</span>ret<span style="color: #990000">,</span> name<span style="color: #990000">,</span> <span style="color: #990000">(</span>args<span style="color: #990000">)),</span></tt></pre></div></div>
<h3 id="_example">Example</h3><div style="clear:left"></div>
<div class="paragraph"><p>Together this would look like</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE</span></span><span style="color: #990000">(</span>foo<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span>
        <span style="font-weight: bold"><span style="color: #000000">LUMIERA_IPROTO</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">,</span> bar<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)),</span>
        <span style="font-weight: bold"><span style="color: #000000">LUMIERA_IPROTO</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">,</span> baz<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">))</span>
<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE</span></span><span style="color: #990000">(</span>foo<span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">,</span>
        <span style="font-weight: bold"><span style="color: #000000">LUMIERA_IPROTO</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">,</span> bar<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)),</span>
        <span style="font-weight: bold"><span style="color: #000000">LUMIERA_IPROTO</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">,</span> baz<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">float</span> i<span style="color: #990000">))</span>
<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Note that the version 2 interface changed the parameter from int to float for the <em>baz</em> function.</p></div>
<div class="paragraph"><p>The above gets expanded to:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface_foo_1</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface</span> interface_header_<span style="color: #990000">;</span>
        <span style="color: #009900">void</span> <span style="color: #990000">(*</span>bar<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
        <span style="color: #009900">int</span> <span style="color: #990000">(*</span>baz<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface_foo_2</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface</span> interface_header_<span style="color: #990000">;</span>
        <span style="color: #009900">void</span> <span style="color: #990000">(*</span>bar<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
        <span style="color: #009900">int</span> <span style="color: #990000">(*</span>baz<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="color: #009900">float</span> i<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p><a id="support-library-PluginInterfaceImplementation"></a></p></div>
</div>
<h2 id="_plugininterfaceimplementation">PluginInterfaceImplementation</h2>
<div class="sectionbody">
<div class="paragraph"><p>A Plugin realizes an interface. This means that actual functions are mapped to the correspondending slots in the interface structure.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE_IMPLEMENT</span></span><span style="color: #990000">(</span>interface<span style="color: #990000">,</span> version<span style="color: #990000">,</span> name<span style="color: #990000">,</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">TODO</span></span><span style="font-style: italic"><span style="color: #9A1900"> some hooks here */</span></span>
        functionnames<span style="color: #990000">...</span>
<span style="color: #990000">);</span></tt></pre></div></div>
<h3 id="_example_2">Example</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">my_bar_function</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #990000">...</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">my_baz_function</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #990000">...</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">my_new_baz_function</span></span> <span style="color: #990000">(</span><span style="color: #009900">float</span> i<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #990000">...</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE_IMPLEMENT</span></span><span style="color: #990000">(</span>foo<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> myfoointerface<span style="color: #990000">,</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">TODO</span></span><span style="font-style: italic"><span style="color: #9A1900"> some hooks here */</span></span>
        my_bar_function<span style="color: #990000">,</span>
        my_baz_function
<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #000000">LUMIERA_INTERFACE_IMPLEMENT</span></span><span style="color: #990000">(</span>foo<span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">,</span> myfoointerface<span style="color: #990000">,</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">TODO</span></span><span style="font-style: italic"><span style="color: #9A1900"> some hooks here */</span></span>
        my_bar_function<span style="color: #990000">,</span>
        my_new_baz_function
<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>The interface implementations expands to something like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface_foo_1</span> myfoointerface_1 <span style="color: #990000">=</span>
<span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">TODO</span></span><span style="font-style: italic"><span style="color: #9A1900"> header initialization */</span></span>
        my_bar_function<span style="color: #990000">,</span>
        my_baz_function
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">lumiera_interface_foo_2</span> myfoointerface_2 <span style="color: #990000">=</span>
<span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* </span></span><span style="font-weight: bold"><span style="background-color: #66FFFF">TODO</span></span><span style="font-style: italic"><span style="color: #9A1900"> header initialization */</span></span>
        my_bar_function<span style="color: #990000">,</span>
        my_new_baz_function
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p><a id="support-library-PluginLibrary"></a></p></div>
</div>
<h2 id="_pluginlibrary">PluginLibrary</h2>
<div class="sectionbody">
<h3 id="_lumiera_plugin_api">Lumiera Plugin API</h3><div style="clear:left"></div>
<div class="paragraph"><p>There are only a few functions to manage Plugins. Actually a user requests interfaces. The libraries which implement Plugins are managed transparently.</p></div>
<div class="paragraph"><p>Interfaces are exported as instances and are not necessary singleton. This means that a single Plugin can export the same interface type several times under different names. The naming rules for interfaces need to be defined elsewhere.</p></div>
<h4 id="_opening_an_interface">opening an Interface</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>LumieraInterface
<span style="font-weight: bold"><span style="color: #000000">lumiera_interface_open</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> plugin<span style="color: #990000">,</span>
                          <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> name<span style="color: #990000">,</span>
                          <span style="color: #008080">size_t</span> min_revision<span style="color: #990000">);</span></tt></pre></div></div>
<h5 id="_parameters">Parameters</h5>
<div class="ulist"><ul>
<li>
<p>
<tt>plugin</tt> is the name of the Plugin whose interface to use. Plugins are looked up in $LUMIERA_PLUGIN_PATH, which is a colon separated list of directories, and then in $plugin_install_dir which is the directory where standard plugins get installed when installing Lumiera (example: /usr/local/lib/lumiera/). The name itself can contain slashes, see PluginHierachy for details. It shall not include a library extension (.so). When NULL is passed, an interface from the main application is queried.
</p>
</li>
<li>
<p>
<tt>name</tt> is the name of the queried interface.
</p>
</li>
<li>
<p>
<tt>min_revision</tt> is the expected minimal size of the interface structure, since interfaces are extended by adding new protos at the end, the size gives a unique value for each new revision.
</p>
</li>
</ul></div>
<h5 id="_semantic">Semantic</h5>
<div class="paragraph"><p>Interfaces can opened multiple times and need to be closed for each call to open.</p></div>
<h5 id="_return">Return</h5>
<div class="paragraph"><p>This function returns a pointer to the requested interface on success or NULL in case of an error. See <tt>lumiera_interface_error</tt> about handing errors.</p></div>
<h4 id="_closing_an_interface">closing an Interface</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_interface_close</span></span> <span style="color: #990000">(</span><span style="color: #008080">LumieraInterface</span> self<span style="color: #990000">);</span></tt></pre></div></div>
<h5 id="_parameters_2">Parameters</h5>
<div class="ulist"><ul>
<li>
<p>
<tt>self</tt> is the handle to the interface to be closed. It is safe to pass NULL. This makes the call just a no-op.
</p>
</li>
</ul></div>
<h5 id="_semantic_2">Semantic</h5>
<div class="paragraph"><p>The interface handle must not be used after this function is called.</p></div>
<div class="paragraph"><p>This function always succeeds (or results in undefined behavior when the user passes an illegal parameter)</p></div>
<h4 id="_calling_functions">calling functions</h4>
<div class="paragraph"><p>Calling function is simply done by dereferencing the interface slots. See HowtoUsePlugin for an example.</p></div>
<h4 id="_unload_unused_plugins">unload unused plugins</h4>
<div class="paragraph"><p>Plugins which are no longer in use are not automatically unloaded. The user can use this functions to unload the Plugins.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_plugin_unload</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> plugin<span style="color: #990000">);</span></tt></pre></div></div>
<h5 id="_parameters_3">Parameters</h5>
<div class="ulist"><ul>
<li>
<p>
<tt>plugin</tt> name of the plugin to be unloaded
</p>
</li>
</ul></div>
<h5 id="_semantic_3">Semantic</h5>
<div class="paragraph"><p>Tries to unload the named plugin. This only works when nothing else uses the Plugin.</p></div>
<h5 id="_return_2">Return</h5>
<div class="paragraph"><p>Returns 0 on success or the number of active users on failure. See <tt>lumiera_interface_error</tt> about handing errors.</p></div>
<h4 id="_expire_unused_plugins">expire unused plugins</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_plugin_expire</span></span> <span style="color: #990000">(</span><span style="color: #008080">time_t</span> age<span style="color: #990000">);</span></tt></pre></div></div>
<h5 id="_parameters_4">Parameters</h5>
<div class="ulist"><ul>
<li>
<p>
<tt>age</tt> time in seconds when the plugin was last used
</p>
</li>
</ul></div>
<h5 id="_semantic_4">Semantic</h5>
<div class="paragraph"><p>Calls <tt>lumiera_plugin_unload()</tt> for each Plugin which has not been used for more than <tt>age</tt> seconds. This function might be infrequently called by the scheduler to remove things which are not needed (example: once a hour, remove plugins which have not been used for 2 hours).</p></div>
<h5 id="_return_3">Return</h5>
<div class="paragraph"><p>always succeeds.</p></div>
<h4 id="_error_handling">error handling</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">lumiera_plugin_error</span></span> <span style="color: #990000">();</span></tt></pre></div></div>
<h5 id="_semantic_5">Semantic</h5>
<div class="paragraph"><p>Indicate last error, reset error state. Errors are thread local.</p></div>
<h5 id="_return_4">Return</h5>
<div class="paragraph"><p>Returns a pointer to the most recent error occurred in the plugin loader. This pointer is guaranteed to point to a C string with a unique comparable address. NULL if no error happened.</p></div>
<div class="paragraph"><p>Note that the error state gets cleared by calling this function. The application may store it temporary for further handling.</p></div>
<h4 id="_c_exceptions">C++ exceptions</h4>
<div class="paragraph"><p>TODO</p></div>
<div class="paragraph"><p><a id="support-library-PluginVersioningCases"></a></p></div>
</div>
<h2 id="_pluginversioningcases">PluginVersioningCases</h2>
<div class="sectionbody">
<h3 id="_compatibility_matrix">Compatibility matrix</h3><div style="clear:left"></div>
<div class="tableblock">
<table rules="rows"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Source compatibility</caption>
<col width="160" />
<col width="320" />
<col width="320" />
<tbody valign="top">
  <tr>
    <td align="left">
    <strong><sub>CALLER</sub> \ <sup>CALLEE</sup></strong>*
    </td>
    <td align="left">
    OLD<sup>**</sup>
    </td>
    <td align="left">
    NEW<sup>**</sup>
    </td>
  </tr>
  <tr>
    <td align="left">
    OLD
    </td>
    <td align="left">
    works
    </td>
    <td align="left">
    works but a recent interface definition must be available
    </td>
  </tr>
  <tr>
    <td align="left">
    NEW
    </td>
    <td align="left">
    works
    </td>
    <td align="left">
    works
    </td>
  </tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="rows"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Binary compatibility</caption>
<col width="160" />
<col width="320" />
<col width="320" />
<tbody valign="top">
  <tr>
    <td align="left">
    <strong><sub>CALLER</sub> \ <sup>CALLEE</sup></strong>*
    </td>
    <td align="left">
    OLD<sup>**</sup>
    </td>
    <td align="left">
    NEW<sup>**</sup>
    </td>
  </tr>
  <tr>
    <td align="left">
    OLD
    </td>
    <td align="left">
    works
    </td>
    <td align="left">
    works
    </td>
  </tr>
  <tr>
    <td align="left">
    NEW
    </td>
    <td align="left">
    caller gets "revision not sufficient" at runtime and should implement fallbacks
    </td>
    <td align="left">
    works
    </td>
  </tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><sup>*</sup>) CALLER is the user of an interface, CALLEE is the interface provider (usually a plugin)</p></div>
<div class="paragraph"><p><sup>**</sup>) OLD means an initial revision, NEW means some later revision of an interface</p></div>
<h3 id="_observations">Observations</h3><div style="clear:left"></div>
<div class="paragraph"><p>Compiling a newer Plugin for some older main application release has some quirks (interface definitions are intended to be shipped with the main application). This should be rarely the case.</p></div>
<div class="paragraph"><p>When compiling, older Plugins should be updated to new interface revisions.
Caller should provide a fallback to older interface revisions for binary compatibility.</p></div>
<div class="paragraph"><p>Generally, sources should just be properly maintained and updated to use the most recent interfaces revision.</p></div>
<div class="paragraph"><p>For binary compatibility everything will work well, provided that the caller kept proper fallback functionality for older interface revisions. Plugins which are independently distributed (packaged) in binary form don&#8217;t need to be updated with every new main application release and just work.</p></div>
<div class="paragraph"><p><a id="support-library-Plugins"></a></p></div>
</div>
<h2 id="_plugins">Plugins</h2>
<div class="sectionbody">
<div class="paragraph"><p>Lumiera will use a very simple and language neutral plugin system. The focus is on easy and independent distribution of plugins and small specific interfaces. Ultimate flexibility is of second concern.</p></div>
<h3 id="_concept">Concept</h3><div style="clear:left"></div>
<div class="paragraph"><p>Plugins are just shared libraries which offer well defined Interfaces. A Plugin may offer more than one interface and may in turn request/use interfaces from other Plugins or from the main application.</p></div>
<h3 id="_interfaces">Interfaces</h3><div style="clear:left"></div>
<div class="paragraph"><p>Plugin interfaces are simple C structs with some metadata at the beginning and function prototypes added at the end. With some macros we can map simple functions to versioned interfaces. Compiled plugins will stay compatible even if the interface is extended, while sourcecode need maintenance.</p></div>
<div class="paragraph"><p>This fosters the idea of updating plugins when the source is available, while still having the ability to deploy packaged binary plugins which will be compatible with newer interface versions.</p></div>
<div class="paragraph"><p>The Plugin System is written in C with some helper preprocessor macros. There will be some support to handle C++ specialties.</p></div>
<h3 id="_versioning">Versioning</h3><div style="clear:left"></div>
<div class="paragraph"><p>Each interface/prototype is versioned. How this works together is explained in PluginVersioningCases. Version identifiers will be used to form a C identifier. I suggest to use a monotonic incrementing number, starting at 1 for versioning and maybe using a special number 0 for interfaces which are in development. When the interface development is finished the 0 has to be replaced by the next number in turn. This ensures that no-one accidentally uses/relies on an interface which is not yet well defined.</p></div>
<h3 id="_plugin_support_includes">Plugin Support includes</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#PluginInterfaceDefinition">An interface definition language</a>
</p>
</li>
<li>
<p>
<a href="#PluginInterfaceImplementation">An interface implementation language</a>
</p>
</li>
<li>
<p>
<a href="#SelectingInterfaces">Selecting interface based on capabilities</a>
</p>
</li>
<li>
<p>
<a href="#PluginLibrary">Library support to access plugins</a>
</p>
</li>
</ul></div>
<h3 id="_tutorial_how_to_use_plugins">Tutorial, how to use Plugins</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#HowtoDefineInterface">Define an interface</a>
</p>
</li>
<li>
<p>
Implement an Plugin with an interface in
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="#HowtoCPlugin">C</a>
</p>
</li>
<li>
<p>
<a href="#HowtoCppPlugin">C++</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="#HowtoUsePlugin">Use this Plugin</a>
</p>
</li>
</ul></div>
<h4 id="_planned">Planned</h4>
<div class="ulist"><ul>
<li>
<p>
enumerating interfaces of a plugin
</p>
</li>
<li>
<p>
pattern matching interfaces&#8201;&#8212;&#8201;find the best possible interface
</p>
</li>
</ul></div>
<div class="paragraph"><p><a id="support-library-SafeCLib"></a></p></div>
</div>
<h2 id="_safeclib">SafeCLib</h2>
<div class="sectionbody">
<h3 id="_memory_allocation">Memory allocation</h3><div style="clear:left"></div>
<div class="ulist"><ul>
<li>
<p>
<tt>lumiera_malloc()</tt> Succceeds or dies, no need for error handling.
</p>
</li>
</ul></div>
<h3 id="_string_functions">String functions</h3><div style="clear:left"></div>
<div class="paragraph"><p>Small wrapers and extensions to the string.h functions, handle NULL pointers gracefully.
* <tt>lumiera_strndup()</tt> Succceeds or dies, no need for error handling.
* <tt>lumiera_strncmp()</tt> <tt>lumiera_streq()</tt> Optimized comparing same addresses.</p></div>
<h3 id="_round_robin_temporary_buffers">Round robin temporary buffers</h3><div style="clear:left"></div>
<div class="paragraph"><p>Provides 64 buffers per thread which are recycled with each use, the idea here is to have fast buffers for temporal data without need for explicit heap management or stack waste.</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>lumiera_tmpbuf_provide ()</tt> Acquire a temporary buffer. doesn&#8217;t need to be freed. Stays valid for the next 63 tmpbuf calls.
</p>
</li>
<li>
<p>
<tt>lumiera_tmpbuf_strndup ()</tt> Duplicate string to a tmpbuf.
</p>
</li>
<li>
<p>
<tt>lumiera_tmpbuf_sprintf ()</tt> Construct a string in a tmpbuf.
</p>
</li>
</ul></div>
<div class="paragraph"><p><a id="support-library-SelectingInterfaces"></a></p></div>
</div>
<h2 id="_selectinginterfaces">SelectingInterfaces</h2>
<div class="sectionbody">
<div class="paragraph"><p>Each Plugin can export different Interfaces, even same interfaces with different capabilities like a effect for different color models or such.</p></div>
<div class="paragraph"><p>Plugins announce their interfaces and capabilities and we implement a deduction system which chooses the best matching interface for the task.</p></div>
<div class="paragraph"><p><a id="support-library-SupportLibrary"></a></p></div>
</div>
<h2 id="_supportlibrary">SupportLibrary</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Support Library contains all tools we need at various places, but by themselves don&#8217;t defines a subsystem on their own.</p></div>
<div class="paragraph"><p>These things are:
* <a href="#Plugins">a Plugin loader</a>
* <a href="#ErrorHandling">ErrorHandling</a>
* a wrapper for POSIX Threads
<strong> Thread creation joining and canceling
</strong> <a href="#LockingPrimitives">Locking primitives like Condition variables and Mutexes</a>
* <a href="#SafeCLib">Some tools and wrapers around the C library</a>
* <a href="#Cuckoo">O(1) hashtable using Cuckoo hashing</a></p></div>
<div class="paragraph"><p>(&#8230; to be continued)</p></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2009-09-18 18:10:05 EDT
</div>
</div>
</body>
</html>
