AsciiDoc Day Guide
==================

.How help the Lumiera project as non developer

The task of the day is: + 
to convert all the documents stored on the MoinMoin wiki at Pipapo.org into Asciidoc markup language.


NOTE: This guide is based on Ubuntu. Adapt the commands to your distro. 

There are only two important tools you must get familiar with for helping on Lumiera: *AsciiDoc* and *git*.

[TOC]

1. Get acquainted with AsciiDoc.
--------------------------------

AsciiDoc is a lightweight markup language. This AsciiDoc Day Guide is written in AsciiDoc. + 
If you install the special AsciiDoc "converter program" you can convert AsciiDoc documents to HTML. 

All the pages of the Lumiera website are written in AsciiDoc and automaticaly converted to HTML.

Now, let's convert this guide to HTML!

  * You need to install asciidoc first. Use this terminal command:

 sudo apt-get install asciidoc
 
  * Save the file `AsciiDocDayGuide.txt` in your home folder.

  * Convert the file running the following command:

 asciidoc AsciiDocDayGuide.txt
 
  * A file `AsciiDocDayGuide.html` will be produced. Admire it in your browser!

To know in details the AsciiDoc markup see the http://www.methods.co.nz/asciidoc/userguide.html[AsciiDoc User Guide] or have a look at this http://powerman.name/doc/asciidoc[cheatsheet]. 

2. Get acquainted with git
--------------------------

Git is a distributed revision control system that helps keeping track of changes of a series of files, usually software source code.
 
All the files of the Lumiera websites are stored in a git repository. All the changes are tracked. + 
You can browse the website files and the history of changes thanks to the gitweb pretty interface at:
http://www.lumiera.org/gitweb?p=website;a=summary[]

Some documents are still on the MoinMoin wiki and need to be converted to asciidoc. For that purpose a dedicated git repo called `moinmoin2asciidoc/mob` has been created. Browse it at: http://www.lumiera.org/gitweb?p=moinmoin2asciidoc/mob;a=summary[]

Now, let's copy this repository to your computer.

 * First install git with:
 
 sudo apt-get install git-core
 
 * Get the moinmoin2asciidoc mob repository with :
 
 git clone git://git.lumiera.org/moinmoin2asciidoc/mob

 * A folder called `mob` is now in your home folder. It contains no HTML files, just TXT files written in asciidoc. 

We can now start the conversion task.

3. Install the conversion script
--------------------------------

A conversion script has been written by Christian Thaeter to ease the task.

 * Download the conversion script with the following terminal command:
 
 wget http://lists.lumiera.org/pipermail/lumiera-work/attachments/20080906/f0e616f6/attachment.txt
 
 * Install it with the following command:
 
 sudo mv attachment.txt /usr/local/bin/moin2asciidoc
 
 * Set the correct permissions with:
 
 chmod +x /usr/local/bin/moin2asciidoc

4. Get a wiki file to convert
-----------------------------

  * To get a list of pages still to be converted, click on the following link:
 
http://www.pipapo.org/pipawiki?action=fullsearch&context=180&value=title%3ALumiera+-title%3ALogos+-title%3ANames+-title%3ANamingProcess+-r%3Aasciidoced&fullsearch=Text[]

 * Alternatively you can go to the http://www.pipapo.org/pipawiki/Lumiera[entry page] of the Lumiera section of the Wiki at Pipapo.org. In the search field at the top right enter the following command:  `title:Lumiera -title:Logos -title:Names -title:NamingProcess -r:asciidoced` + 
Then click on _Titles_ for a short list and on _Text_ for a verbose list of pages still to be converted. 

 * Click on a page. Select _Edit (text)_ from the options at the top. Double check that there are no coments that tells the page has already been converted. E.g. something like: `##asciidoced by alcarinque. Notify him if you edit.`
 
 * Add a comment just below the title `=Title=`. The comment must be exaclty like this (replace ... with your name): `Taken for being asciidoced by .... Notify ... if you edit`. Please be careful in avoiding typos that can confuse the search engine. Save the changes adding `Taken for being asciidoced by ....` in the comment field.
 
 * Select _Raw Text_ from the _More Actions_ drop down menu.

 * In Firefox go to _File -> Save page as..._  and save the Raw text as a file with no extension inside the _mob_ folder.

5. Convert the wiki file
------------------------

  * Open a terminal and enter the mob folder with:
 
 cd mob

 * Run the conversion script with the following command (replace `wikifile` with the name of the wikifile - remember you can do that with _drag and drop_ the file icon into the terminal):
 
 moin2asciidoc wikifile
 
 * Admire the just created file with .txt extension.

5. Correct the asciidoc markup manually
---------------------------------------

 * Convert the .txt file to .html with asciidoc (replace `file.txt` with the name of the file to convert):
 
 asciidoc file.txt
 
 * If you get an error about section title out of sequence, you need to edit the file and fix it. Make sure you get the correct order of titles (e.g. no level 2 without a level 1 first). See the http://powerman.name/doc/asciidoc#_headers[cheatsheet] to know more.

 * Repeat the process of running and fixing until you can run asciidoc with no errors.

 * Make sure the .txt document starts with the document header (required). See the http://powerman.name/doc/asciidoc#_document_header_required[cheatsheet] to know more.
 
 * If the wiki file has a header table, convert it using the asciidoc markup like in the example below:
 
 [grid="all"]
 `------------`-----------------------
 *State*         _Final_
 *Date*          _2007-06-29_
 *Proposed by*   link:ct[]
 -------------------------------------
 
 * Open the converted HTML file in Firefox and make sure it is nicely formatted. If you don't like it, tweak the code to make it nicer. You might want to compare the wiki page and your local HTML in two separate Firefox windows.

IMPORTANT: All internal Wiki links are converted to links that point to the old locations at http://www.pipapo.org/. That's wrong, but _leave them alone_. We'll fix them later.
 
6. Put the file in place and mark it
------------------------------------

 * Once you are happy with the conversion and formatting, move the final .txt file in the correct folder inside the _Lumiera_ folder of the mob repo.
 
 * Delete the source wiki file in the mob folder (the one with no extension).
 
 * Delete the asciidoc created HTML file.
 
 * Go to the original page at Pipawiki and mark it as converted. Using the _Edit (text)_ mode, add a comment at the beginning. Add your name and your e-mail (or raffa's mail if you prefer). Something like:
 
  ##asciidoced by raffa. Please, notify any editing to raffa[AT]lumiera.org
  
7. Track your changes in git
----------------------------  

For this task the list of git commands you need to know is very short. Nevertheless if you are curious and want to know more about git, have a look at this http://www.spheredev.org/wiki/Git_for_the_lazy[Git for the lazy] page.

Now it's time to notify git you confirm the changes you've made. 

 * Make sure your working directory is the _mob_ git repo. If not, enter it with the terminal command: 
 
 cd mob
  
 * Make sure your repo is up to date with
 
 git pull
  
 * Check the status of the repo with
 
 git status
 
 * Add the new asciidoc files to the index (replace `asciidocfile.txt` with then name of the file you have just converted):
 
 git add asciidocfile.txt
 
 * Commit your changes and comment them. Add your commit message after the -m option, leaving the second line blank. Don't forget quotation marks!
 
  git commit -m "Add asciidoced page
  
  converted by ..."
  
 * If you can't commit and get an error about trailing whitespaces, fix the file in your text editor, add it and commit it again.
 
 * If you can't commit because you get a  unresolved merge conflict error in line 2, you need to help git not to take the asciidoc header markup =========== for a conflict.
Disable the pre-commit hook with the following command:

 chmod -x .git/hooks/pre-commit

 * Push back your changes to the mob repo at http://www.lumiera.org/gitweb?p=moinmoin2asciidoc/mob;a=summary[Lumiera Gitweb] with:
 
 git push
 
If your curiosity about git is making you nervous, have a look at this http://git-scm.com/documentation[collection] of git documentation.
 
.Thanks for your contribution! Git will remember you forever.

:-)

NOTE: Command line lovers can find some more tips http://lists.lumiera.org/pipermail/lumiera-work/2008-September/000018.html[here].
dummy
